<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Lab 08 Starter</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: whitesmoke;
            font-family: Lato, sans-serif;
            color: #0D0000;
        }
        header {
            padding: 6px 10%;
        }
        h1 {
            display: inline-block;
            margin-right: 20px;
            color: #001323;
        }
        h2 {
            display: inline-block;
            color: #001323;
        }
        #map {
            width: 80%;
            height: 540px;
            margin: 10px auto;
        }
        footer {
            padding: 6px 10%;
            width: 80%;
        }
        p {
            font-size: 1em;
            color: #001323;
        }
    </style>
</head>

<body>
    <header>
        <h1>Map Title</h1>
        <h2>Map Subtitle</h2>
    </header>

    <div id='map'></div>

    <footer>
        <p>Map authored by<br>Francisco Lovko<br>For: MAPS672</p>
        <p>The above map displays point data of US power facilities that are powered by Wind and some plants on the map use Natural Gas as their primary power source and Petroleum as a secondary source of power to produce electricity. By clicking on the individual points a popup will display the name of the power plant, installed capacity, and the outputs produced by each respective power source.</p>
    </footer>
        <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
        <script src="power-plants.js"></script>
        <script>

        var map = L.map('map', {
          center: [36,-94],
          zoom: 4,
        });

        var tiles = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
            subdomains: 'abcd',
            maxZoom: 19
        });

        tiles.addTo(map);

        plants.features.sort(function(a, b) {
            return b.properties.capacity_mw - a.properties.capacity_mw;
        });

        L.geoJson(plants, {
            pointToLayer: function(feature,latlng) {
                //console.log(feature.properties)
                return L.circleMarker(latlng, {
                color: '#44ec01',
                weight: 1,
                fillColor: '#06dbcb',
                fillOpacity: .8,
                radius: getRadius(feature.properties.capacity_mw) // returns get radius function
                });
            },

            filter: function(feature, layer) {
                if(feature.properties.fuel_source.Wind ||
                    feature.properties.fuel_source['Natural Gas']  &&
                    feature.properties.fuel_source.Petroleum)
                return feature;
                },

        onEachFeature : function(feature, layer) {
//           console.log(layer);
            var plantName = feature.properties.plant_name;
            var output = feature.properties.capacity_mw;
            var windOutput = feature.properties.fuel_source.Wind;
            var naturalGasOutput = feature.properties.fuel_source['Natural Gas'];
            var petroleumOutput = feature.properties.fuel_source.Petroleum;

            var popup = "<b>" + plantName + "</b><br>" + output + " MW";

            // if windOutput is true (or not undefined)
            if(windOutput) {
              popup += "<br><b>Wind: </b>" + " " + windOutput; // add to popup
            }
            // same with naturalGasOutput
            if(naturalGasOutput) {
              popup += "<br><b>" + "Natural Gas: </b>" + " " + naturalGasOutput + " MW";;
            }
            // and petroleumOutput
            if(petroleumOutput) {
              popup += "<br><b>Petroleum: </b>" + petroleumOutput + " MW";
            }

            layer.bindPopup(popup);

            layer.on('mouseover', function() {
                layer.setStyle({
                    fillColor:'#0b8ff2'
                })
            });

            layer.on('mouseout', function() {
                layer.setStyle({
                    fillColor: '#06dbcb'
                    })
                });
            },

        }).addTo(map)
        function getRadius(area) {
            var radius = Math.sqrt(area/Math.PI);
            return radius * .7;
        }

    </script>

</body>

</html>
